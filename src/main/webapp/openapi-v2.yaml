openapi: 3.0.3
info:
  title: æ ¡å›­ä¹¦å‹ä¼š API
  description: |
    # ğŸ“š æ ¡å›­äºŒæ‰‹ä¹¦äº¤æ˜“å¹³å° API æ–‡æ¡£
    
    æ¬¢è¿ä½¿ç”¨æ ¡å›­ä¹¦å‹ä¼šAPIï¼è¿™æ˜¯ä¸€ä¸ªä¸ºæ ¡å›­ç”¨æˆ·æä¾›äºŒæ‰‹ä¹¦äº¤æ˜“æœåŠ¡çš„ç»¼åˆå¹³å°ã€‚
    
    ## âœ¨ ä¸»è¦åŠŸèƒ½
    
    - **ğŸ“– ä¹¦ç±ç®¡ç†** - å‘å¸ƒã€æµè§ˆã€æœç´¢ã€è´­ä¹°äºŒæ‰‹ä¹¦ç±
    - **ğŸ‘¤ ç”¨æˆ·ç³»ç»Ÿ** - æ³¨å†Œã€ç™»å½•ã€ä¸ªäººèµ„æ–™ç®¡ç†
    - **ğŸ›’ è®¢å•æµç¨‹** - åˆ›å»ºè®¢å•ã€æ”¯ä»˜ã€å‘è´§ã€ç¡®è®¤æ”¶è´§
    - **ğŸ’° é’±åŒ…ç³»ç»Ÿ** - å……å€¼ã€æç°ã€ä½™é¢ç®¡ç†
    - **ğŸ’¬ æ¶ˆæ¯é€šä¿¡** - ç”¨æˆ·é—´äº¤æµã€è®¢å•ç”³è¯‰
    - **ğŸ“Š ç»Ÿè®¡åˆ†æ** - ç”¨æˆ·äº¤æ˜“ç»Ÿè®¡ã€è¯„åˆ†ç³»ç»Ÿ
    
    ## ğŸ” è®¤è¯è¯´æ˜
    
    æœ¬APIä½¿ç”¨åŸºäºSessionçš„è®¤è¯æœºåˆ¶ã€‚å¤§éƒ¨åˆ†æ¥å£éœ€è¦ç”¨æˆ·å…ˆç™»å½•ï¼Œç™»å½•åä¼šå»ºç«‹Sessionä¼šè¯ã€‚
    
    **è®¤è¯æµç¨‹ï¼š**
    1. è°ƒç”¨ `/login` æ¥å£è¿›è¡Œç™»å½•
    2. æœåŠ¡å™¨è¿”å›Session Cookie (JSESSIONID)
    3. åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦Cookieè¿›è¡Œèº«ä»½éªŒè¯
    
    ## ğŸ“ ä½¿ç”¨è¯´æ˜
    
    - æ‰€æœ‰æ—¶é—´æˆ³é‡‡ç”¨ISO 8601æ ¼å¼
    - ä»·æ ¼å•ä½ä¸ºäººæ°‘å¸(å…ƒ)ï¼Œä¿ç•™ä¸¤ä½å°æ•°
    - åˆ†é¡µå‚æ•°ï¼špageä»1å¼€å§‹ï¼Œsizeé»˜è®¤ä¸º10
    - å“åº”æ ¼å¼ç»Ÿä¸€ä¸ºJSON
    
  version: 2.0.0
  contact:
    name: æ ¡å›­ä¹¦å‹ä¼šæŠ€æœ¯æ”¯æŒ
    email: support@bookswap.example.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8080
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨

tags:
  - name: auth
    description: ğŸ” ç”¨æˆ·è®¤è¯
  - name: books
    description: ğŸ“š ä¹¦ç±ç®¡ç†
  - name: users
    description: ğŸ‘¤ ç”¨æˆ·ç®¡ç†
  - name: orders
    description: ğŸ›’ è®¢å•ç®¡ç†
  - name: wallet
    description: ğŸ’° é’±åŒ…ç³»ç»Ÿ
  - name: messages
    description: ğŸ’¬ æ¶ˆæ¯ç³»ç»Ÿ

paths:
  # ==================== è®¤è¯ç›¸å…³ ====================
  /login:
    post:
      tags:
        - auth
      summary: ç”¨æˆ·ç™»å½•
      description: ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿ
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "alice"
                password:
                  type: string
                  format: password
                  example: "alice123"
      responses:
        '200':
          description: ç™»å½•æˆåŠŸï¼Œé‡å®šå‘åˆ°é¦–é¡µ
        '401':
          description: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
  
  /register:
    post:
      tags:
        - auth
      summary: ç”¨æˆ·æ³¨å†Œ
      description: æ³¨å†Œæ–°ç”¨æˆ·è´¦å·
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - username
                - password
                - email
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 20
                  example: "alice"
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: "alice123"
                email:
                  type: string
                  format: email
                  example: "alice@example.com"
      responses:
        '201':
          description: æ³¨å†ŒæˆåŠŸï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
        '400':
          description: å‚æ•°é”™è¯¯æˆ–ç”¨æˆ·åå·²å­˜åœ¨
  
  /logout:
    get:
      tags:
        - auth
      summary: ç”¨æˆ·ç™»å‡º
      description: é€€å‡ºç™»å½•ï¼Œæ¸…é™¤Session
      responses:
        '302':
          description: ç™»å‡ºæˆåŠŸï¼Œé‡å®šå‘åˆ°æ¬¢è¿é¡µ

  # ==================== ä¹¦ç±ç®¡ç† ====================
  /api/books:
    get:
      tags:
        - books
      summary: è·å–ä¹¦ç±åˆ—è¡¨
      description: æ”¯æŒåˆ†é¡µå’Œæœç´¢çš„ä¹¦ç±åˆ—è¡¨æ¥å£
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: size
          in: query
          schema:
            type: integer
            default: 10
        - name: keyword
          in: query
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸè¿”å›ä¹¦ç±åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookListResponse'
    
    post:
      tags:
        - books
      summary: åˆ›å»ºæ–°ä¹¦ç±
      description: å‘å¸ƒæ–°çš„äºŒæ‰‹ä¹¦ï¼Œéœ€è¦ç™»å½•
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCreateRequest'
      responses:
        '201':
          description: ä¹¦ç±åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
  
  /api/books/{id}:
    get:
      tags:
        - books
      summary: è·å–ä¹¦ç±è¯¦æƒ…
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: æˆåŠŸè¿”å›ä¹¦ç±è¯¦æƒ…
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: ä¹¦ç±ä¸å­˜åœ¨
    
    put:
      tags:
        - books
      summary: æ›´æ–°ä¹¦ç±ä¿¡æ¯
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCreateRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
        '403':
          description: æ— æƒé™
    
    delete:
      tags:
        - books
      summary: åˆ é™¤ä¹¦ç±
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ
        '403':
          description: æ— æƒé™
  
  /add-book:
    get:
      tags:
        - books
      summary: å‘å¸ƒä¹¦ç±é¡µé¢
      description: è¿”å›å‘å¸ƒä¹¦ç±çš„è¡¨å•é¡µé¢
      responses:
        '200':
          description: è¿”å›JSPé¡µé¢
  
  /book-detail:
    get:
      tags:
        - books
      summary: ä¹¦ç±è¯¦æƒ…é¡µé¢
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: è¿”å›ä¹¦ç±è¯¦æƒ…é¡µé¢
  
  /book-list:
    get:
      tags:
        - books
      summary: ä¹¦ç±åˆ—è¡¨é¡µé¢
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      responses:
        '200':
          description: è¿”å›ä¹¦ç±åˆ—è¡¨é¡µé¢
  
  /search:
    get:
      tags:
        - books
      summary: æœç´¢ä¹¦ç±
      parameters:
        - name: keyword
          in: query
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      responses:
        '200':
          description: è¿”å›æœç´¢ç»“æœé¡µé¢

  # ==================== è®¢å•ç®¡ç† ====================
  /api/orders:
    get:
      tags:
        - orders
      summary: è·å–è®¢å•åˆ—è¡¨
      security:
        - sessionAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [buyer, seller, all]
            default: buyer
      responses:
        '200':
          description: æˆåŠŸè¿”å›è®¢å•åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    
    post:
      tags:
        - orders
      summary: åˆ›å»ºè®¢å•
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - bookId
                - shippingAddress
              properties:
                bookId:
                  type: integer
                shippingAddress:
                  type: string
      responses:
        '201':
          description: è®¢å•åˆ›å»ºæˆåŠŸ
  
  /api/orders/{id}:
    get:
      tags:
        - orders
      summary: è·å–è®¢å•è¯¦æƒ…
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸè¿”å›è®¢å•è¯¦æƒ…
  
  /api/orders/{id}/pay:
    put:
      tags:
        - orders
      summary: æ”¯ä»˜è®¢å•
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                paymentPassword:
                  type: string
      responses:
        '200':
          description: æ”¯ä»˜æˆåŠŸ
  
  /api/orders/{id}/ship:
    put:
      tags:
        - orders
      summary: è®¢å•å‘è´§
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: å‘è´§æˆåŠŸ
  
  /api/orders/{id}/confirm:
    put:
      tags:
        - orders
      summary: ç¡®è®¤æ”¶è´§
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ç¡®è®¤æ”¶è´§æˆåŠŸ
  
  /buy-book:
    get:
      tags:
        - orders
      summary: è´­ä¹°ä¹¦ç±é¡µé¢
      parameters:
        - name: bookId
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: è¿”å›è´­ä¹°é¡µé¢
  
  /orders:
    get:
      tags:
        - orders
      summary: è®¢å•åˆ—è¡¨é¡µé¢(ä¹°å®¶è§†è§’)
      responses:
        '200':
          description: è¿”å›è®¢å•åˆ—è¡¨é¡µé¢
  
  /seller-orders:
    get:
      tags:
        - orders
      summary: è®¢å•åˆ—è¡¨é¡µé¢(å–å®¶è§†è§’)
      responses:
        '200':
          description: è¿”å›å–å®¶è®¢å•é¡µé¢

  # ==================== ç”¨æˆ·ç®¡ç† ====================
  /api/users:
    get:
      tags:
        - users
      summary: è·å–ç”¨æˆ·åˆ—è¡¨
      description: ä»…ç®¡ç†å‘˜å¯è®¿é—®
      security:
        - sessionAuth: []
      responses:
        '200':
          description: æˆåŠŸè¿”å›ç”¨æˆ·åˆ—è¡¨
  
  /api/users/{id}:
    get:
      tags:
        - users
      summary: è·å–ç”¨æˆ·ä¿¡æ¯
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸè¿”å›ç”¨æˆ·ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
  
  /user-profile:
    get:
      tags:
        - users
      summary: ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢
      responses:
        '200':
          description: è¿”å›ä¸ªäººèµ„æ–™é¡µé¢

  # ==================== é’±åŒ…ç³»ç»Ÿ ====================
  /wallet:
    get:
      tags:
        - wallet
      summary: é’±åŒ…é¡µé¢
      security:
        - sessionAuth: []
      responses:
        '200':
          description: è¿”å›é’±åŒ…é¡µé¢
    
    post:
      tags:
        - wallet
      summary: é’±åŒ…æ“ä½œ
      security:
        - sessionAuth: []
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                action:
                  type: string
                  enum: [deposit, withdraw]
                amount:
                  type: number
                  format: float
      responses:
        '200':
          description: æ“ä½œæˆåŠŸ

  # ==================== æ¶ˆæ¯ç³»ç»Ÿ ====================
  /messages:
    get:
      tags:
        - messages
      summary: æŸ¥çœ‹å¯¹è¯æ¶ˆæ¯
      security:
        - sessionAuth: []
      parameters:
        - name: bookId
          in: query
          required: true
          schema:
            type: integer
        - name: otherUserId
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: è¿”å›æ¶ˆæ¯é¡µé¢
    
    post:
      tags:
        - messages
      summary: å‘é€æ¶ˆæ¯
      security:
        - sessionAuth: []
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - receiverId
                - bookId
                - content
              properties:
                receiverId:
                  type: integer
                bookId:
                  type: integer
                content:
                  type: string
      responses:
        '201':
          description: æ¶ˆæ¯å‘é€æˆåŠŸ
  
  /message-list:
    get:
      tags:
        - messages
      summary: æ¶ˆæ¯åˆ—è¡¨é¡µé¢
      security:
        - sessionAuth: []
      responses:
        '200':
          description: è¿”å›æ¶ˆæ¯åˆ—è¡¨é¡µé¢
  
  /appeal:
    post:
      tags:
        - messages
      summary: æäº¤ç”³è¯‰
      security:
        - sessionAuth: []
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - orderId
                - content
              properties:
                orderId:
                  type: integer
                content:
                  type: string
      responses:
        '201':
          description: ç”³è¯‰æäº¤æˆåŠŸ

components:
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: JSESSIONID
      description: åŸºäºSessionçš„è®¤è¯

  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "æ“ä½œæˆåŠŸ"
        data:
          type: object
        code:
          type: integer
          example: 200
        timestamp:
          type: string
          format: date-time
    
    BookListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                content:
                  type: array
                  items:
                    $ref: '#/components/schemas/Book'
                currentPage:
                  type: integer
                pageSize:
                  type: integer
                totalElements:
                  type: integer
                totalPages:
                  type: integer
    
    Book:
      type: object
      properties:
        id:
          type: integer
          format: int64
        title:
          type: string
          example: "Javaæ ¸å¿ƒæŠ€æœ¯"
        author:
          type: string
          example: "Cay S. Horstmann"
        price:
          type: number
          format: float
          example: 89.00
        description:
          type: string
        imageUrl:
          type: string
        sellerId:
          type: integer
        status:
          type: string
          enum: [available, sold, reserved, removed]
          example: "available"
        createdAt:
          type: string
          format: date-time
    
    BookCreateRequest:
      type: object
      required:
        - title
        - author
        - price
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
        author:
          type: string
          minLength: 1
          maxLength: 100
        price:
          type: number
          format: float
          minimum: 0.01
          maximum: 999999.99
        description:
          type: string
        imageUrl:
          type: string
    
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        email:
          type: string
          format: email
        rating:
          type: number
          format: float
          minimum: 1.0
          maximum: 5.0
        totalRatings:
          type: integer
        role:
          type: string
          enum: [user, admin]
        createdAt:
          type: string
          format: date-time
    
    Order:
      type: object
      properties:
        id:
          type: integer
          format: int64
        bookId:
          type: integer
        buyerId:
          type: integer
        shippingAddress:
          type: string
        status:
          type: string
          enum: [pending, paid, shipped, completed, cancelled]
        bookTitle:
          type: string
        bookAuthor:
          type: string
        bookPrice:
          type: number
          format: float
        orderedAt:
          type: string
          format: date-time
    
    Wallet:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
        balance:
          type: number
          format: float
          example: 100.00
    
    Message:
      type: object
      properties:
        id:
          type: integer
        senderId:
          type: integer
        receiverId:
          type: integer
        bookId:
          type: integer
        content:
          type: string
        sentAt:
          type: string
          format: date-time
        isRead:
          type: boolean
