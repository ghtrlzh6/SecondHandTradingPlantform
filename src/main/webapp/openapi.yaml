openapi: 3.0.3
info:
  title: Campus BookSwap API
  description: |
    校园二手书交易平台API
    
    这是一个为校园用户提供二手书交易服务的平台。
    用户可以浏览、搜索、发布和购买二手书籍。
  version: 1.0.0
  contact:
    name: API Support
    email: support@bookswap.example.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8080/demo_war_exploded/api
    description: 本地开发服务器
  - url: https://api.bookswap.example.com
    description: 生产环境服务器

tags:
  - name: books
    description: 书籍相关操作
  - name: users
    description: 用户相关操作

paths:
  /books:
    get:
      tags:
        - books
      summary: 获取所有书籍列表
      description: 返回平台上的所有书籍列表，支持分页和筛选
      parameters:
        - name: page
          in: query
          description: 页码
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          description: 每页条数
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: keyword
          in: query
          description: 搜索关键词
          schema:
            type: string
      responses:
        '200':
          description: 成功返回书籍列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/Book'
                  page:
                    type: integer
                    description: 当前页码
                  size:
                    type: integer
                    description: 每页条数
                  total:
                    type: integer
                    description: 总记录数
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags:
        - books
      summary: 添加新书籍
      description: 添加一本新书籍到平台
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookInput'
      responses:
        '201':
          description: 书籍添加成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /books/{id}:
    get:
      tags:
        - books
      summary: 获取书籍详情
      description: 根据书籍ID获取特定书籍的详细信息
      parameters:
        - name: id
          in: path
          required: true
          description: 书籍ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功返回书籍详情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '404':
          description: 书籍未找到
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - books
      summary: 更新书籍信息
      description: 更新指定书籍的信息
      parameters:
        - name: id
          in: path
          required: true
          description: 书籍ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookInput'
      responses:
        '200':
          description: 书籍更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 书籍未找到
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
        - books
      summary: 删除书籍
      description: 删除指定ID的书籍
      parameters:
        - name: id
          in: path
          required: true
          description: 书籍ID
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: 书籍删除成功
        '404':
          description: 书籍未找到
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/register:
    post:
      tags:
        - users
      summary: 用户注册
      description: 注册一个新用户
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
      responses:
        '201':
          description: 用户注册成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/login:
    post:
      tags:
        - users
      summary: 用户登录
      description: 用户登录系统
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserLoginResponse'
        '401':
          description: 用户名或密码错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Book:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 书籍ID
        title:
          type: string
          description: 书名
          example: "Java核心技术"
        author:
          type: string
          description: 作者
          example: "Cay S. Horstmann"
        price:
          type: number
          format: float
          description: 价格
          example: 59.9
        description:
          type: string
          description: 描述
          example: "《Java核心技术》是Java领域极具影响力和口碑的著作"
        imageUrl:
          type: string
          description: 图片URL
          example: "https://example.com/book-cover.jpg"
        sellerId:
          type: integer
          format: int64
          description: 卖家ID
        createdAt:
          type: string
          format: date-time
          description: 创建时间
          example: "2025-12-06T10:00:00Z"
      required:
        - title
        - author
        - price
    
    BookInput:
      type: object
      properties:
        title:
          type: string
          description: 书名
          example: "Java核心技术"
        author:
          type: string
          description: 作者
          example: "Cay S. Horstmann"
        price:
          type: number
          format: float
          description: 价格
          example: 59.9
        description:
          type: string
          description: 描述
          example: "《Java核心技术》是Java领域极具影响力和口碑的著作"
        imageUrl:
          type: string
          description: 图片URL
          example: "https://example.com/book-cover.jpg"
      required:
        - title
        - author
        - price
    
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 用户ID
        username:
          type: string
          description: 用户名
        email:
          type: string
          format: email
          description: 邮箱
        createdAt:
          type: string
          format: date-time
          description: 注册时间
    
    UserRegistration:
      type: object
      properties:
        username:
          type: string
          description: 用户名
        email:
          type: string
          format: email
          description: 邮箱
        password:
          type: string
          format: password
          description: 密码
      required:
        - username
        - email
        - password
    
    UserLogin:
      type: object
      properties:
        username:
          type: string
          description: 用户名
        password:
          type: string
          format: password
          description: 密码
      required:
        - username
        - password
    
    UserLoginResponse:
      type: object
      properties:
        token:
          type: string
          description: 认证令牌
        user:
          $ref: '#/components/schemas/User'
    
    Error:
      type: object
      properties:
        code:
          type: integer
          description: 错误代码
        message:
          type: string
          description: 错误信息
      required:
        - code
        - message