openapi: 3.0.3
info:
  title: æ ¡å›­ä¹¦å‹ä¼š API
  description: |
    # ğŸ“š æ ¡å›­äºŒæ‰‹ä¹¦äº¤æ˜“å¹³å° API æ–‡æ¡£
    
    æ¬¢è¿ä½¿ç”¨æ ¡å›­ä¹¦å‹ä¼šAPIï¼è¿™æ˜¯ä¸€ä¸ªä¸ºæ ¡å›­ç”¨æˆ·æä¾›äºŒæ‰‹ä¹¦äº¤æ˜“æœåŠ¡çš„ç»¼åˆå¹³å°ã€‚
    
    ## âœ¨ ä¸»è¦åŠŸèƒ½
    
    - **ğŸ“– ä¹¦ç±ç®¡ç†** - å‘å¸ƒã€æµè§ˆã€æœç´¢ã€è´­ä¹°äºŒæ‰‹ä¹¦ç±
    - **ğŸ‘¤ ç”¨æˆ·ç³»ç»Ÿ** - æ³¨å†Œã€ç™»å½•ã€ä¸ªäººèµ„æ–™ç®¡ç†
    - **ğŸ›’ è®¢å•æµç¨‹** - åˆ›å»ºè®¢å•ã€æ”¯ä»˜ã€å‘è´§ã€ç¡®è®¤æ”¶è´§
    - **ğŸ’° é’±åŒ…ç³»ç»Ÿ** - å……å€¼ã€æç°ã€ä½™é¢ç®¡ç†
    - **ğŸ’¬ æ¶ˆæ¯é€šä¿¡** - ç”¨æˆ·é—´äº¤æµã€è®¢å•ç”³è¯‰
    - **ğŸ“Š ç»Ÿè®¡åˆ†æ** - ç”¨æˆ·äº¤æ˜“ç»Ÿè®¡ã€è¯„åˆ†ç³»ç»Ÿ
    
    ## ğŸ” è®¤è¯è¯´æ˜
    
    æœ¬APIä½¿ç”¨åŸºäºSessionçš„è®¤è¯æœºåˆ¶ã€‚å¤§éƒ¨åˆ†æ¥å£éœ€è¦ç”¨æˆ·å…ˆç™»å½•ï¼Œç™»å½•åä¼šå»ºç«‹Sessionä¼šè¯ã€‚
    
    **è®¤è¯æµç¨‹ï¼š**
    1. è°ƒç”¨ `/login` æ¥å£è¿›è¡Œç™»å½•
    2. æœåŠ¡å™¨è¿”å›Session Cookie (JSESSIONID)
    3. åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦Cookieè¿›è¡Œèº«ä»½éªŒè¯
    
    ## ğŸ“ ä½¿ç”¨è¯´æ˜
    
    - æ‰€æœ‰æ—¶é—´æˆ³é‡‡ç”¨ISO 8601æ ¼å¼
    - ä»·æ ¼å•ä½ä¸ºäººæ°‘å¸(å…ƒ)ï¼Œä¿ç•™ä¸¤ä½å°æ•°
    - åˆ†é¡µå‚æ•°ï¼špageä»1å¼€å§‹ï¼Œsizeé»˜è®¤ä¸º10
    - å“åº”æ ¼å¼ç»Ÿä¸€ä¸ºJSON
    
    ## ğŸŒ æœåŠ¡å™¨ç¯å¢ƒ
    
    - **å¼€å‘ç¯å¢ƒ**: http://localhost:8080
    - **ç”Ÿäº§ç¯å¢ƒ**: https://api.bookswap.example.com
    
  version: 2.0.0
  contact:
    name: æ ¡å›­ä¹¦å‹ä¼šæŠ€æœ¯æ”¯æŒ
    email: support@bookswap.example.com
    url: https://bookswap.example.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  termsOfService: https://bookswap.example.com/terms

servers:
  - url: http://localhost:8080
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: https://api.bookswap.example.com
    description: ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨

tags:
  - name: auth
    description: ğŸ” ç”¨æˆ·è®¤è¯ - ç™»å½•ã€æ³¨å†Œã€ç™»å‡º
  - name: books
    description: ğŸ“š ä¹¦ç±ç®¡ç† - CRUDæ“ä½œã€æœç´¢ã€åˆ†é¡µ
  - name: users
    description: ğŸ‘¤ ç”¨æˆ·ç®¡ç† - ä¸ªäººèµ„æ–™ã€ç»Ÿè®¡ä¿¡æ¯
  - name: orders
    description: ğŸ›’ è®¢å•ç®¡ç† - åˆ›å»ºã€æ”¯ä»˜ã€å‘è´§ã€æ”¶è´§
  - name: wallet
    description: ğŸ’° é’±åŒ…ç³»ç»Ÿ - å……å€¼ã€æç°ã€ä½™é¢æŸ¥è¯¢
  - name: messages
    description: ğŸ’¬ æ¶ˆæ¯ç³»ç»Ÿ - å‘é€æ¶ˆæ¯ã€æŸ¥çœ‹å¯¹è¯

paths:
  /books:
    get:
      tags:
        - books
      summary: è·å–æ‰€æœ‰ä¹¦ç±åˆ—è¡¨
      description: è¿”å›å¹³å°ä¸Šçš„æ‰€æœ‰ä¹¦ç±åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œç­›é€‰
      parameters:
        - name: page
          in: query
          description: é¡µç 
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          description: æ¯é¡µæ¡æ•°
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: keyword
          in: query
          description: æœç´¢å…³é”®è¯
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸè¿”å›ä¹¦ç±åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/Book'
                  page:
                    type: integer
                    description: å½“å‰é¡µç 
                  size:
                    type: integer
                    description: æ¯é¡µæ¡æ•°
                  total:
                    type: integer
                    description: æ€»è®°å½•æ•°
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags:
        - books
      summary: æ·»åŠ æ–°ä¹¦ç±
      description: æ·»åŠ ä¸€æœ¬æ–°ä¹¦ç±åˆ°å¹³å°
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookInput'
      responses:
        '201':
          description: ä¹¦ç±æ·»åŠ æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: æœªæˆæƒ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /books/{id}:
    get:
      tags:
        - books
      summary: è·å–ä¹¦ç±è¯¦æƒ…
      description: æ ¹æ®ä¹¦ç±IDè·å–ç‰¹å®šä¹¦ç±çš„è¯¦ç»†ä¿¡æ¯
      parameters:
        - name: id
          in: path
          required: true
          description: ä¹¦ç±ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: æˆåŠŸè¿”å›ä¹¦ç±è¯¦æƒ…
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '404':
          description: ä¹¦ç±æœªæ‰¾åˆ°
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - books
      summary: æ›´æ–°ä¹¦ç±ä¿¡æ¯
      description: æ›´æ–°æŒ‡å®šä¹¦ç±çš„ä¿¡æ¯
      parameters:
        - name: id
          in: path
          required: true
          description: ä¹¦ç±ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookInput'
      responses:
        '200':
          description: ä¹¦ç±æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: ä¹¦ç±æœªæ‰¾åˆ°
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
        - books
      summary: åˆ é™¤ä¹¦ç±
      description: åˆ é™¤æŒ‡å®šIDçš„ä¹¦ç±
      parameters:
        - name: id
          in: path
          required: true
          description: ä¹¦ç±ID
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: ä¹¦ç±åˆ é™¤æˆåŠŸ
        '404':
          description: ä¹¦ç±æœªæ‰¾åˆ°
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/register:
    post:
      tags:
        - users
      summary: ç”¨æˆ·æ³¨å†Œ
      description: æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
      responses:
        '201':
          description: ç”¨æˆ·æ³¨å†ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/login:
    post:
      tags:
        - users
      summary: ç”¨æˆ·ç™»å½•
      description: ç”¨æˆ·ç™»å½•ç³»ç»Ÿ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserLoginResponse'
        '401':
          description: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Book:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ä¹¦ç±ID
        title:
          type: string
          description: ä¹¦å
          example: "Javaæ ¸å¿ƒæŠ€æœ¯"
        author:
          type: string
          description: ä½œè€…
          example: "Cay S. Horstmann"
        price:
          type: number
          format: float
          description: ä»·æ ¼
          example: 59.9
        description:
          type: string
          description: æè¿°
          example: "ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ã€‹æ˜¯Javaé¢†åŸŸæå…·å½±å“åŠ›å’Œå£ç¢‘çš„è‘—ä½œ"
        imageUrl:
          type: string
          description: å›¾ç‰‡URL
          example: "https://example.com/book-cover.jpg"
        sellerId:
          type: integer
          format: int64
          description: å–å®¶ID
        createdAt:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´
          example: "2025-12-06T10:00:00Z"
      required:
        - title
        - author
        - price
    
    BookInput:
      type: object
      properties:
        title:
          type: string
          description: ä¹¦å
          example: "Javaæ ¸å¿ƒæŠ€æœ¯"
        author:
          type: string
          description: ä½œè€…
          example: "Cay S. Horstmann"
        price:
          type: number
          format: float
          description: ä»·æ ¼
          example: 59.9
        description:
          type: string
          description: æè¿°
          example: "ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ã€‹æ˜¯Javaé¢†åŸŸæå…·å½±å“åŠ›å’Œå£ç¢‘çš„è‘—ä½œ"
        imageUrl:
          type: string
          description: å›¾ç‰‡URL
          example: "https://example.com/book-cover.jpg"
      required:
        - title
        - author
        - price
    
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ç”¨æˆ·ID
        username:
          type: string
          description: ç”¨æˆ·å
        email:
          type: string
          format: email
          description: é‚®ç®±
        createdAt:
          type: string
          format: date-time
          description: æ³¨å†Œæ—¶é—´
    
    UserRegistration:
      type: object
      properties:
        username:
          type: string
          description: ç”¨æˆ·å
        email:
          type: string
          format: email
          description: é‚®ç®±
        password:
          type: string
          format: password
          description: å¯†ç 
      required:
        - username
        - email
        - password
    
    UserLogin:
      type: object
      properties:
        username:
          type: string
          description: ç”¨æˆ·å
        password:
          type: string
          format: password
          description: å¯†ç 
      required:
        - username
        - password
    
    UserLoginResponse:
      type: object
      properties:
        token:
          type: string
          description: è®¤è¯ä»¤ç‰Œ
        user:
          $ref: '#/components/schemas/User'
    
    Error:
      type: object
      properties:
        code:
          type: integer
          description: é”™è¯¯ä»£ç 
        message:
          type: string
          description: é”™è¯¯ä¿¡æ¯
      required:
        - code
        - message